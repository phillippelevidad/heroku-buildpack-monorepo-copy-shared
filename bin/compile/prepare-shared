#!/bin/bash

# This script copies the shared folder into frontend/apps/app
# It should be run BEFORE the monorepo buildpack
# 
# To use this as a buildpack:
# 1. Create a git repo with this file and a bin/compile file
# 2. Add it as the first buildpack before the monorepo one

set -e

echo "-----> Preparing shared folder for monorepo buildpack"

APP_DIR="frontend/apps/app"
SHARED_SOURCE="shared"
SHARED_DEST="$APP_DIR/shared"

# Check if shared folder exists at repo root and app directory exists
if [ -d "$SHARED_SOURCE" ] && [ -d "$APP_DIR" ]; then
  echo "       Copying shared folder into $APP_DIR..."
  rm -rf "$SHARED_DEST" 2>/dev/null || true
  cp -r "$SHARED_SOURCE" "$SHARED_DEST"
  echo "       âœ“ Shared folder copied successfully"
  echo "       The monorepo buildpack will now copy $APP_DIR (with shared) to root"
  exit 0
else
  echo "       WARNING: Shared folder or app directory not found"
  echo "       Shared source: $SHARED_SOURCE (exists: $([ -d "$SHARED_SOURCE" ] && echo 'yes' || echo 'no'))"
  echo "       App directory: $APP_DIR (exists: $([ -d "$APP_DIR" ] && echo 'yes' || echo 'no'))"
  # Don't fail - let the monorepo buildpack continue
  exit 0
fi
